<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" xmlns:layout="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- inject contextPath -->
    <meta name="contextPath" th:content="@{/}">
    <meta name="pAid" th:content="${session.targetAddress.pubId}">
    <title>Product - item</title>
    <link rel="shortcut icon" th:href="@{/assets/compiled/svg/favicon.svg}" type="image/x-icon}">
    <link rel="shortcut icon"
          href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAiCAYAAADRcLDBAAAEs2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjMzIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMzQiCiAgIGV4aWY6Q29sb3JTcGFjZT0iMSIKICAgdGlmZjpJbWFnZVdpZHRoPSIzMyIKICAgdGlmZjpJbWFnZUxlbmd0aD0iMzQiCiAgIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjIiCiAgIHRpZmY6WFJlc29sdXRpb249Ijk2LjAiCiAgIHRpZmY6WVJlc29sdXRpb249Ijk2LjAiCiAgIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiCiAgIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJwcm9kdWNlZCIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWZmaW5pdHkgRGVzaWduZXIgMS4xMC4xIgogICAgICBzdEV2dDp3aGVuPSIyMDIyLTAzLTMxVDEwOjUwOjIzKzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz5V57uAAAABgmlDQ1BzUkdCIElFQzYxOTY2LTIuMQAAKJF1kc8rRFEUxz9maORHo1hYKC9hISNGTWwsRn4VFmOUX5uZZ36oeTOv954kW2WrKLHxa8FfwFZZK0WkZClrYoOe87ypmWTO7dzzud97z+nec8ETzaiaWd4NWtYyIiNhZWZ2TvE946WZSjqoj6mmPjE1HKWkfdxR5sSbgFOr9Ll/rXoxYapQVik8oOqGJTwqPL5i6Q5vCzeo6dii8KlwpyEXFL519LjLLw6nXP5y2IhGBsFTJ6ykijhexGra0ITl5bRqmWU1fx/nJTWJ7PSUxBbxJkwijBBGYYwhBgnRQ7/MIQIE6ZIVJfK7f/MnyUmuKrPOKgZLpEhj0SnqslRPSEyKnpCRYdXp/9++msneoFu9JgwVT7b91ga+LfjetO3PQ9v+PgLvI1xkC/m5A+h7F32zoLXug38dzi4LWnwHzjeg8UGPGbFfySvuSSbh9QRqZ6H+Gqrm3Z7l9zm+h+iafNUV7O5Bu5z3L/wAdthn7QIme0YAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAJTSURBVFiF7Zi9axRBGIefEw2IdxFBRQsLWUTBaywSK4ubdSGVIY1Y6HZql8ZKCGIqwX/AYLmCgVQKfiDn7jZeEQMWfsSAHAiKqPiB5mIgELWYOW5vzc3O7niHhT/YZvY37/swM/vOzJbIqVq9uQ04CYwCI8AhYAlYAB4Dc7HnrOSJWcoJcBS4ARzQ2F4BZ2LPmTeNuykHwEWgkQGAet9QfiMZjUSt3hwD7psGTWgs9pwH1hC1enMYeA7sKwDxBqjGnvNdZzKZjqmCAKh+U1kmEwi3IEBbIsugnY5avTkEtIAtFhBrQCX2nLVehqyRqFoCAAwBh3WGLAhbgCRIYYinwLolwLqKUwwi9pxV4KUlxKKKUwxC6ZElRCPLYAJxGfhSEOCz6m8HEXvOB2CyIMSk6m8HoXQTmMkJcA2YNTHm3congOvATo3tE3A29pxbpnFzQSiQPcB55IFmFNgFfEQeahaAGZMpsIJIAZWAHcDX2HN+2cT6r39GxmvC9aPNwH5gO1BOPFuBVWAZue0vA9+A12EgjPadnhCuH1WAE8ivYAQ4ohKaagV4gvxi5oG7YSA2vApsCOH60WngKrA3R9IsvQUuhIGY00K4flQG7gHH/mLytB4C42EgfrQb0mV7us8AAMeBS8mGNMR4nwHamtBB7B4QRNdaS0M8GxDEog7iyoAguvJ0QYSBuAOcAt71Kfl7wA8DcTvZ2KtOlJEr+ByyQtqqhTyHTIeB+ONeqi3brh+VgIN0fohUgWGggizZFTplu12yW8iy/YLOGWMpDMTPXnl+Az9vj2HERYqPAAAAAElFTkSuQmCC"
          type="image/png">
    <link rel="stylesheet" th:href="@{/assets/compiled/css/app.css}">
    <link rel="stylesheet" th:href="@{/assets/compiled/css/app-dark.css}">
    <link rel="stylesheet" th:href="@{/assets/compiled/css/iconly.css}">
    <link rel="stylesheet" th:href="@{/mine/js/css/toast.css}">

    <link href="https://unpkg.com/filepond/dist/filepond.css" rel="stylesheet">
    <link href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/assets/vendors/toastify/toastify.css}">
    <link rel="stylesheet" th:href="@{/mine/js/css/additional-index.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/mine/js/css/breadcrumbs.css}">
    <!--link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"-->
    <style>
        .change-image-btn {
            font-size: 0.85rem;
            padding: 0.25rem 0.6rem;
        }

        .filepond--root {
          width: auto !important;
          height: auto !important;
          min-height: auto !important;
          border: none !important;
          background: none !important;
        }

        .filepond--drop-label {
          background: none !important;
          border: none !important;
          padding: 0 !important;
          margin: 0 !important;
          display: inline !important;
          font-size: 0.85rem !important;
          color: #0d6efd !important;
          cursor: pointer !important;
        }

        .filepond--drop-label:hover {
          text-decoration: none;
        }

        .filepond--panel-root,
        .filepond--credits {
          display: none !important;
        }

        .filepond-btn {
          background-color: #007bff;  /* biru */
          color: white;
          padding: 4px 10px;
          border-radius: 6px;
          font-size: 0.75rem;
          border: none;
          cursor: pointer;
          transition: background 0.2s ease-in-out;
        }

        .filepond-btn:hover {
          background-color: #0056b3;  /* hover lebih gelap */
        }

        @media (max-width: 576px) {
            .card-body .d-flex {
                justify-content: center !important;
            }
        }

        /*
        .card-wrapper {
          margin-bottom: 5px !important;
        }
        */

        .card {
          margin-bottom: 0.5rem !important;
        }

        .card-body {
          padding-bottom: 0.75rem !important;
          padding-top: 0.75rem !important;
        }

        /* Warna latar belakang body accordion */
          #collapseOne .accordion-body {
            background-color: #e3f2fd; /* biru muda lembut */
          }

          /* Kalau ada tombol accordion header */
          #headingOne .accordion-button {
            background-color: #bbdefb; /* biru muda */
            color: #0d47a1;            /* teks biru tua */
          }

          /* Saat tombol accordion terbuka (expanded) */
          #headingOne .accordion-button:not(.collapsed) {
            background-color: #90caf9; /* biru sedikit lebih terang */
            color: #0d47a1;
            box-shadow: none;
          }

        .accordion-button .category-label {
          color: [[${@appGlobals.get('colorPrimaryBlue')}]];
          font-weight: 600;
          font-size: 120%;
          margin-left: 4px;
          transition: color 0.2s ease;
        }

        /* Saat tombol TIDAK collapsed (berarti terbuka) */
        .accordion-button:not(.collapsed) .category-label {
          color: [[${@appGlobals.get('colorPrimaryBlue')}]];
        }

        .accordion-icon i {
          transition: transform 0.3s ease;
          color: #0d6efd;
        }

        /* saat aktif (accordion terbuka) */
        .accordion-button:not(.collapsed) .accordion-icon i {
          transform: rotate(180deg);
        }


    </style>

</head>
<body>
<div id="app">
    <!-- Sidebar slot -->
    <div layout:fragment="sidebar">
        <div th:replace="~{/pages/v1/manager/product/sidebar.html :: sidebar(${activePage}, ${activeSub}, '${listActiveLocation}')}"></div>
    </div>
    <div id="main">
        <!-- Notification hamburg slot -->
        <div layout:fragment="left-header">
            <div th:replace="~{/pages/v1/fragments/hamburger-header.html :: left-header}"></div>
        </div>
        <!-- Notification header slot
        <div layout:fragment="left-header">
            <div th:replace="~{/pages/v1/manager/fragments/notification-header.html :: right-header}"></div>
        </div-->
        <!-- Index header slot -->
        <div layout:fragment="logout-and-other-hidden-form">
            <div th:replace="~{/pages/v1/fragments/logout-and-other-hidden-form.html :: hidden-form(${clientName}, ${updatePath}, ${deletePath})}"></div>
        </div>

        <!-- Main content slot -->
        <div class="page-heading">
            <ol class="breadcrumb">
                <li sec:authorize="hasRole('SUPERADMIN')" class="breadcrumb-item active">
                    <a href="#" th:text="|${#messages.msg('label.dashboard')}|"></a>
                </li>
                <li sec:authorize="hasAnyRole('SUPERADMIN','ADMIN')" class="breadcrumb-item active">
                    <a th:href="@{/v2/admin/home}" th:text="|${#messages.msg('label.dashboard')}|"></a>
                </li>
                <li sec:authorize="hasAnyRole('SUPERADMIN','ADMIN','MANAGER')" class="breadcrumb-item active">
                    <a th:href="@{/v1/manager/home(pid=${targetAddress.pubId})}" th:text="|${#messages.msg('label.management')}|"></a>
                </li>
                <li sec:authorize="hasAnyRole('SUPERADMIN','ADMIN','MANAGER')" class="breadcrumb-item active">
                    <a th:href="@{/v1/manager/manage/product(activePage='dashboard')}"
                       th:text="|${#messages.msg('label.manager.setting.product')}|"></a>
                </li>
                <li sec:authorize="hasAnyRole('SUPERADMIN','ADMIN','MANAGER')" class="breadcrumb-item active">
                    <a th:href="@{/v1/manager/manage/product/item(pid=${targetAddress.pubId},activePage='menu1',activeSub='subMenu1-2')}"
                    th:text="|${#messages.msg('label.manager.setting.product.item')}|"></a>
                </li>
                <li sec:authorize="hasAnyRole('SUPERADMIN','ADMIN','MANAGER')" class="breadcrumb-item"
                    aria-current="page"><!-- th:text="|${#messages.msg('label.itemList')}|"-->
                    <span th:with="
                    parts=${#strings.arraySplit(trimPath, '/')},
                    lastIndex=${#lists.size(parts) - 1}">

                    <span th:each="p, iter : ${parts}">
                        <span th:if="${iter.last}"
                              th:text="${p.trim()}">
                        </span>
                    </span>
                </span>
                </li>
            </ol>
            <h3>
                <span style="font-size:70%; display:block; line-height:1;"
                      th:text="|${#strings.toUpperCase(#messages.msg('label.setting'))}|">
                </span>
                <span th:with="
                    parts=${#strings.arraySplit(trimPath, '/')},
                    lastIndex=${#lists.size(parts) - 1}">

                    <span th:each="p, iter : ${parts}">
                        <span th:if="${!iter.last}"
                              th:text="|${p.trim()} / |"
                              style="color: gray;font-size:65%"></span>
                        <span th:if="${iter.last}"
                              th:text="${p.trim()}"
                              style="color: #0d6efd; font-weight: 600;font-size:120%"></span>
                    </span>
                </span>

                <!--span th:text="|${#strings.toUpperCase(#messages.msg('label.manager.setting.product.item'))} / ${#strings.toUpperCase(#messages.msg('label.manager.setting.product.barang'))}|"></span-->

            </h3>
        </div>
        <div layout:fragment="content">
            <div class="page-content">
                <!-- list group button & badge start-->
                <div class="d-inline-flex align-items-center gap-2 flex-nowrap">
                    <button type="button" id="add"
                            class="d-flex align-items-center justify-content-center"
                            th:style="|background-color:${@appGlobals.get('colorPrimaryBlue')};
                       color:white;padding-bottom:8px;padding-right:13px;
                       width:32px;
                       height:32px;
                       border:none;
                       border-radius:50%;
                       line-height:0;|">
                        <i class="bi bi-plus" style="font-size:150%;"></i>
                    </button>
                    <!--a th:href="@{/produk}" th:text="#{label.add}"></a-->
                    <span th:text="#{label.add}" id="txtAdd"></span>


                    <span>/</span>

                    <button type="button" id="src"
                            class="d-flex align-items-center justify-content-center"
                            th:style="|background-color:${@appGlobals.get('colorSecondaryGrey')};
                       color:white;
                       width:32px;
                       height:32px;
                       border:none;
                       border-radius:50%;
                       line-height:0;|">
                        <i class="bi bi-search" style="font-size:100%;"></i>
                    </button>
                    <span th:text="#{label.search}" id="txtSearch"></span>
                </div>

                <div class="card" id="searchCard">
                    <div class="card-content">
                        <div class="card-body">
                            <div class="form form-horizontal">
                                <div class="form-body">
                                    <div class="row">
                                        <div class="col-12">
                                            <div class="form-group has-icon-left">
                                                <div class="position-relative">
                                                    <input type="text" class="form-control"
                                                           th:placeholder="#{label.search}" id="searchKeyword">
                                                    <div class="form-control-icon">
                                                        <i class="bi bi-search"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card collapse-icon accordion-icon-rotate" id="collapsableCard">
                    <div class="card-body">
                        <div class="accordion" id="cardAccordion">
                            <div class="accordion" id="accordionExample">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingOne">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                                data-bs-target="#collapseOne" aria-expanded="false"
                                                aria-controls="collapseOne">
                                            <!-- Ikon plus -->
                                            <i class="bi bi-plus d-inline-flex align-items-center justify-content-center me-2"
                                               th:style="|background-color:${@appGlobals.get('colorPrimaryBlue')};
                                                       color:white;
                                                       width:22px;
                                                       height:22px;
                                                       border-radius:50%;
                                                       font-size:150%;|">
                                            </i>
                                            <span th:utext="|#{label.item}|"
                                                  style="color: gray;font-size:95%"></span>
                                            <span th:text="${targetCategoryName}"
                                                  style="font-weight: 600;font-size:120%; margin-left:4px" class="category-label"></span>

                                        </button>
                                    </h2>
                                    <div id="collapseOne" class="accordion-collapse collapse "
                                         aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                                        <div class="accordion-body" id="addSearch">
                                            <form class="form" method="post" th:action="@{/v1/manager/manage/product/item/{categoryId}(categoryId=${categoryId},activePage=${activePage},activeSub=${activeSub})}">
                                                <div class="form-body">
                                                    <div class="form-group">
                                                        <!--label for="feedback1" class="sr-only" th:text="#{label.itemName}"></label-->
                                                        <input type="hidden" name="path" th:value="${path}">
                                                        <input type="text" id="feedback1" class="form-control" th:placeholder="#{label.itemName}"
                                                               name="name">
                                                    </div>
                                                    <div class="form-group form-label-group">
                                                        <textarea class="form-control" name="description" id="label-textarea" rows="3"
                                                                  th:placeholder="#{label.description}"></textarea>
                                                        <label for="label-textarea"></label>
                                                    </div>
                                                </div>
                                                <div class="form-actions d-flex justify-content-end">
                                                    <button type="submit" class="btn btn-primary me-1" th:text="#{label.add}"></button>
                                                    <button type="reset" class="btn btn-light-primary" th:text="#{label.cancel}"></button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- list group button & badge ends -->
                <div class="row" id="productList">
                    <!-- ðŸ” Loop semua produk -->
                    <h3 th:if="${#lists.size(listItem) > 0}">
                        <span style="font-size:60%; display:block; line-height:1;padding:10px 0 5px 0;"
                              th:text="|${#messages.msg('label.listProductItem')}:|">
                        </span>
                    </h3>

                    <!--div class="col-xl-4 col-md-6 col-sm-6 col-6 mb-4"-->
                    <div class="col-xl-4 col-md-6 col-sm-12 mb-2"
                         th:each="item, iterStat : ${listItem}" th:attr="data-item-id=${item.id}">
                        <div class="card">
                            <div class="card-content">
                                <div class="card-body">
                                    <div class="accordion accordion-flush"
                                         th:attr="id=${'accordionFlushExample' + iterStat.count}">
                                        <div class="accordion-item">

                                            <!-- Tombol Accordion -->
                                            <button class="accordion-button collapsed p-0 border-0 bg-transparent position-relative" type="button"
                                                    data-bs-toggle="collapse"
                                                    th:attr="data-bs-target=${'#flush-collapseOne' + iterStat.count},
                                                        aria-controls=${'flush-collapseOne' + iterStat.count}">

                                                <!-- Card isi -->
                                                <div class="card w-100 m-0">
                                                    <!--div class="card-header text-center">
                                                        <h2 class="card-title mb-0" th:text="${item.name}">Basic</h2>
                                                    </div-->
                                                    <div class="card-body text-center">
                                                        <h2 class="card-title mb-0 text-primary" th:utext="|${item.name}|"
                                                            th:id="'itemName' + ${item.id}"></h2>
                                                        <!-- ðŸ”¹ Harga tampil -->
                                                        <h4 class="price" th:id="'price-display-' + ${item.id}"
                                                            th:attr="style=${item.price == null or item.price == 0} ? 'display:block;' : 'display:block;'">

                                                            <!--span th:id="'itemPriceFormatted' + ${item.id}"
                                                                  th:text="${#numbers.formatDecimal(item.price, 0, 'POINT', 0, 'COMMA')}"></span-->
                                                            <!-- harga null/kosong -->
                                                            <span th:id="'itemPriceFormatted' + ${item.id}" th:if="${item.price == null or item.price == '' and T(java.lang.Double).parseDouble(item.price) > 0}"
                                                                  class="text-danger" style="font-size:90%"
                                                                  th:text="${#numbers.formatDecimal(0, 0, 'POINT', 0, 'COMMA')}">
                                                            </span>

                                                            <!-- harga ada -->
                                                            <span th:id="'itemPriceFormatted' + ${item.id}" th:if="${item.price != null and item.price != '' and T(java.lang.Double).parseDouble(item.price) > 0}"
                                                                  class="text-secondary" style="font-size:125%"
                                                                  th:text="${#numbers.formatDecimal(item.price, 0, 'POINT', 0, 'COMMA')}">
                                                            </span>

                                                            <!-- stok kosong -->
                                                            <span th:if="${item.stockQuantity == null || item.stockQuantity < 1}"
                                                                  class="text-danger" style="font-size:45%"
                                                                  th:text="${#strings.toLowerCase(#messages.msg('label.stock') + ': ' + (item.stockQuantity == null ? 0 : item.stockQuantity))}">
                                                            </span>

                                                            <!-- stok di bawah alert -->
                                                            <span th:if="${item.stockQuantity >= 1 and item.stockQuantity < item.minStockAlert}"
                                                                  class="text-warning" style="font-size:45%"
                                                                  th:text="${#strings.toLowerCase(#messages.msg('label.stock') + ': ' + (item.stockQuantity == null ? 0 : item.stockQuantity))}">
                                                            </span>

                                                            <!-- stok aman -->
                                                            <span th:if="${item.stockQuantity != null and item.stockQuantity >= item.minStockAlert}"
                                                                  class="text-info"
                                                                  style="font-size:45%"
                                                                  th:text="${#strings.toLowerCase(#messages.msg('label.stock') + ': ' + (item.stockQuantity == null ? 0 : item.stockQuantity))}">
                                                            </span>
                                                        </h4>
                                                        <ul class="list-unstyled" th:attr="data-product-id=${item.id}">
                                                            <!-- ðŸ”¹ Indikator harga belum diatur -->
                                                            <li th:id="'price-notset-' + ${item.id}"
                                                                th:attr="style=${item.price == null or item.price == 0} ? 'display:block;' : 'display:none;'">
                                                                <i class="bi bi-x-circle text-danger"></i>
                                                                <span class="text-danger" th:text="#{msg.priceNotSet}"></span>
                                                            </li>
                                                            <!-- description -->
                                                            <!--li th:id="'desc-ok-' + ${item.id}"
                                                                th:attr="style=${item.description != null and !#strings.isEmpty(item.description)} ? 'display:block;' : 'display:none;'">
                                                                <i class="bi bi-check-circle text-success"></i>
                                                                <span th:text="#{msg.descProvided}"></span>
                                                            </li-->

                                                            <li th:id="'desc-no-' + ${item.id}"
                                                                th:attr="style=${item.description == null or #strings.isEmpty(item.description)} ? 'display:block;' : 'display:none;'">
                                                                <i class="bi bi-x-circle text-danger"></i>
                                                                <span class="text-danger" th:text="#{msg.noDescProvided}"></span>
                                                            </li>
                                                            <!-- image -->
                                                            <li th:id="'status-image-' + ${item.id}"
                                                                th:if="${item.thumbnailUrl != null and !#strings.isEmpty(item.thumbnailUrl)}"
                                                                style="display: none;">
                                                                <i class="bi bi-check-circle text-success"></i>
                                                                <span th:text="#{msg.imageProvided}"></span>
                                                            </li>

                                                            <li th:id="'status-noimage-' + ${item.id}"
                                                                th:if="${item.thumbnailUrl == null or #strings.isEmpty(item.thumbnailUrl)}">
                                                                <i class="bi bi-x-circle text-danger"></i>
                                                                <span class="text-danger" th:text="#{msg.noImageProvided}"></span>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>

                                            </button>


                                            <!-- Isi Accordion -->
                                            <div class="accordion-collapse collapse"
                                                 th:attr="id=${'flush-collapseOne' + iterStat.count},
                                                  aria-labelledby=${'flush-headingOne' + iterStat.count},
                                                  data-bs-parent=${'#accordionFlushExample' + iterStat.count}">
                                                <div class="accordion-body">

                                                    <!-- Tombol edit -->
                                                    <div class="text-center my-2">
                                                        <a class="btn btn-sm btn-outline-primary toggle-edit"
                                                           th:attr="data-target-id=${'collapseExample' + item.id}"
                                                           role="button" style="border-width: 2px;">
                                                            <i class="bi bi-pencil-fill text-primary" style="font-size: 0.7rem;"></i>
                                                        </a>
                                                    </div>

                                                    <!-- Deskripsi -->
                                                    <section class="desc">
                                                        <div class="p-3 text-center">
                                                            <img th:if="${item.imageUrl != null}"
                                                                 th:src="@{${item.thumbnailUrl}}"
                                                                 class="card-thumb img-fluid mb-2 rounded w-100"
                                                                 style="max-height: 200px; object-fit: cover;">
                                                            <input type="file"
                                                                   class="cardImage"
                                                                   name="file"
                                                                   accept="image/*"
                                                                   th:attr="data-product-id=${item.id}, data-has-image=${item.imageUrl != null}">
                                                        </div>
                                                        <p class="card-text fw-bold fs-5 text-center text-info mt-3 mb-0" th:utext="|#{label.description}:|")></p>
                                                        <p class="card-text text-center"
                                                           th:attr="id=${'itemDesc' + item.id}"
                                                           th:text="${#strings.isEmpty(item.description) ? #messages.msg('msg.noDescProvided') : item.description}">
                                                        </p>
                                                    </section>

                                                    <!-- Collapse Form -->
                                                    <div class="collapse"
                                                         th:attr="id=${'collapseExample' + item.id}">
                                                        <h4 class="card-title">Edit Form</h4>
                                                        <form class="form edit-item-form" method="post"
                                                              th:attr="id=${'editForm' + iterStat.count}, data-item-id=${item.id}">
                                                            <div class="form-body">
                                                                <div class="form-group">
                                                                    <label for="feedback1" class="sr-only" th:text="#{label.name}"></label>
                                                                    <input type="text" id="name" class="form-control" placeholder="Name"
                                                                           name="name" th:value="${item.name}" th:id="'formItemName' + ${item.id}">
                                                                </div>

                                                                <div class="form-group form-label-group">
                                                                    <label for="label-textarea" th:text="#{label.description}"></label>
                                                                    <textarea class="form-control" id="description" rows="3" name="description"
                                                                              th:text="${item.description != null ? item.description : ''}"
                                                                              th:placeholder="#{msg.noDescProvided}">
                                                                    </textarea>
                                                                </div>

                                                                <div class="form-group">
                                                                    <label for="price" class="sr-only" th:text="#{label.sellingPrice}"></label>
                                                                    <input type="text" id="price" class="form-control"
                                                                           th:placeholder="#{label.price}"
                                                                           th:value="${#numbers.formatDecimal(item.price, 0, 'POINT', 2, 'COMMA')}"
                                                                           name="price" inputmode="decimal">
                                                                    <!--input type="hidden" th:attr="id=${'itemPrice' + item.id}" th:value="${item.price}" /-->
                                                                    <input type="hidden" id="priceRaw" name="priceRaw"
                                                                           th:value="${item != null && item.price != null ? item.price : 0}">
                                                                </div>

                                                                <div class="form-group">
                                                                    <label for="stock" class="sr-only" th:text="#{label.stock}"></label>
                                                                    <div class="d-flex align-items-center">
                                                                        <input type="number" id="stock" class="form-control me-2"
                                                                               th:value="${item.stockQuantity != null ? item.stockQuantity : 0}"
                                                                               th:placeholder="#{label.quantity}" name="stock"
                                                                               min="0" max="999" step="1"
                                                                               style="width: 100px; text-align: center;" readonly>
                                                                        <a href="#" class="btn btn-outline-secondary" title="Atur Stok">
                                                                            <i class="bi bi-gear-fill"></i>
                                                                        </a>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="form-actions d-flex justify-content-end">
                                                                <button type="submit" class="btn btn-primary me-1">Submit</button>
                                                                <button type="button"
                                                                        class="btn btn-light-primary cancel-collapse"
                                                                        th:attr="data-target-id=${'collapseExample' + item.id}">
                                                                    Cancel
                                                                </button>
                                                            </div>
                                                        </form>
                                                    </div>

                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </div>
        <!-- Footer slot -->
        <div layout:fragment="footer">
            <div th:replace="~{/pages/v1/fragments/footer.html :: footer}"></div>
        </div>
    </div>
</div>

<!-- ðŸ”¹ Toast Notification -->
<!--div id="toast-success" class="toast align-items-center text-white bg-success border-0 position-fixed bottom-0 end-0 m-4" role="alert">
    <div class="d-flex">
        <div class="toast-body">
            âœ… Gambar berhasil diperbarui!
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
</div-->
<!-- List of Toast Msg -->
<div id="toast-msg-update-failed" th:data-msg="#{label.updateFailed}"></div>
<div id="toast-msg-update-success" th:data-msg="#{label.updateSuccessfully}"></div>


<!-- Toast status slot -->
<div layout:fragment="toast-status">
    <div th:replace="~{/pages/v1/fragments/toast/toast-status-process-result :: toast-messages(${successMessage}, ${errorMessage}, ${session.toastTimeout})}"></div>
</div>
<!-- Toast confirm slot -->
<div layout:fragment="toast-confirm">
    <!--div th:replace="~{/pages/v1/manager/fragments/toast-confirm.html :: toast-confirm('cancel', 'update', 'delete')}"></div-->
    <div th:replace="~{/pages/v1/fragments/toast/toast-confirm.html :: toast-confirm('cancel', 'update', 'delete')}"></div>
</div>
<!--script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script-->
<!--script th:src="@{/assets/static/js/bootstrap/V5.3.8/bootstrap.bundle.min.js}"></script-->

<script th:src="@{/assets/static/js/initTheme.js}"></script>
<script th:src="@{/assets/static/js/components/dark.js}"></script>
<script th:src="@{/assets/extensions/perfect-scrollbar/perfect-scrollbar.min.js}"></script>
<script th:src="@{/assets/vendors/toastify/toastify.js}"></script>
<script th:src="@{/assets/compiled/js/app.js}"></script>
<!--script th:src="@{/assets/static/js/pages/dashboard.js}"></script-->
<script th:src="@{/mine/js/toast-handler.js}"></script>
<!-- âœ…filepond Tambahkan di bawah, sebelum </body> -->
<script src="https://unpkg.com/filepond/dist/filepond.min.js"></script>
<script src="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.min.js"></script>
<link href="https://unpkg.com/filepond/dist/filepond.min.css" rel="stylesheet" />
<link href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.min.css" rel="stylesheet" />

<div layout:fragment="modal-confirm-delete">
    <!--div th:replace="~{/pages/v1/manager/fragments/toast-confirm.html :: toast-confirm('cancel', 'update', 'delete')}"></div-->
    <div th:replace="~{/pages/v1/fragments/modal/modal-confirm-delete.html :: modal-confirm-delete(${#strings.toUpperCase(#messages.msg('modal.confirm.delete.title'))},
    #{modal.confirm.delete.body},'itemNameReplaceByJs',#{label.cancel}, #{label.delete})}"></div>
</div>
<!--script th:src="@{/mine/js/modal/modal-confirm-edit-delete.js}"></script-->

<!-- ðŸ”¹ Script -->
<script src="https://unpkg.com/filepond@^4/dist/filepond.js"></script>



<script th:inline="javascript">
    const msgImageProvided = /*[[#{msg.imageProvided}]]*/ 'Image provided';
  const msgNoImageProvided = /*[[#{msg.noImageProvided}]]*/ 'No image provided';

    document.addEventListener("DOMContentLoaded", function () {
        const addBtn = document.getElementById("add");
        const srcBtn = document.getElementById("src");
        const txtAdd = document.getElementById("txtAdd");
        const txtSearch = document.getElementById("txtSearch");
        const searchCard = document.getElementById("searchCard");
        const collapsableCard = document.getElementById("collapsableCard");

        const searchInput = document.getElementById("searchKeyword");
        const productList = document.getElementById("productList");
        const cards = productList ? productList.querySelectorAll(".col-xl-4, .col-md-6, .col-sm-12") : [];

        const colorPrimaryBlue = /*[[${@appGlobals.get('colorPrimaryBlue')}]]*/ '#007bff';
        const colorSecondaryGrey = /*[[${@appGlobals.get('colorSecondaryGrey')}]]*/ '#6c757d';

        // Kondisi awal
        searchCard.style.display = "none";
        collapsableCard.style.display = "block";
        addBtn.style.backgroundColor = colorPrimaryBlue;
        srcBtn.style.backgroundColor = colorSecondaryGrey;

        // Tombol Search
        srcBtn.addEventListener("click", function () {
            searchCard.style.display = "block";
            collapsableCard.style.display = "none";
            srcBtn.style.backgroundColor = colorPrimaryBlue;
            addBtn.style.backgroundColor = colorSecondaryGrey;
        });

        // Tombol Add
        addBtn.addEventListener("click", function () {
            searchCard.style.display = "none";
            collapsableCard.style.display = "block";
            addBtn.style.backgroundColor = colorPrimaryBlue;
            srcBtn.style.backgroundColor = colorSecondaryGrey;

            // ðŸ”¹ Reset filter search
            if (searchInput) {
                searchInput.value = ""; // kosongkan input
                cards.forEach(card => card.style.display = ""); // tampilkan semua kartu
            }
        });

        // ðŸ”¹ Klik teks = klik tombol
        txtAdd.addEventListener("click", function () {
            addBtn.click();
        });

        txtSearch.addEventListener("click", function () {
            srcBtn.click();
        });

        // ðŸ”¹ (Opsional) Tambahkan efek hover pada teks agar terasa interaktif
        [txtAdd, txtSearch].forEach(el => {
            el.style.cursor = "pointer";
            el.addEventListener("mouseenter", () => el.style.textDecoration = "underline");
            el.addEventListener("mouseleave", () => el.style.textDecoration = "none");
        });
    });
</script>
<!-- === SCRIPT UNTUK FORM PENCARIAN DINAMIS === -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("searchKeyword");
        const productList = document.getElementById("productList");
        const cards = productList.querySelectorAll(".col-xl-4, .col-md-6, .col-sm-12");

        searchInput.addEventListener("input", function () {
            const keyword = this.value.trim().toLowerCase();

            cards.forEach(card => {
                const titleElement = card.querySelector(".card-title");
                const descElement = card.querySelector(".card-text");
                const name = titleElement ? titleElement.textContent.toLowerCase() : "";
                const desc = descElement ? descElement.textContent.toLowerCase() : "";

                // kalau deskripsi "Description Unavailable", abaikan
                const isDescUnavailable = desc.includes("description unavailable");

                // kalau keyword kosong â†’ tampilkan semua
                if (keyword === "") {
                    card.style.display = "";
                }
                // kalau keyword cocok dengan nama atau deskripsi â†’ tampilkan
                else if (!isDescUnavailable && (name.includes(keyword) || desc.includes(keyword))) {
                    card.style.display = "";
                }
                // kalau tidak cocok â†’ sembunyikan
                else {
                    card.style.display = "none";
                }
            });
        });
    });
</script>
<!-- colapsable form --->
<script>
    //let initialData = {};
    document.addEventListener('DOMContentLoaded', function () {

        // Simpan nilai awal form saat pertama kali dimuat
        document.querySelectorAll('.edit-item-form').forEach(form => {
            const initialData = {};
            form.querySelectorAll('input, textarea, select').forEach(input => {
                initialData[input.name] = input.value;
                console.log(input.name+" = "+input.value);
            });
            // simpan ke dataset form
            form.dataset.initialData = JSON.stringify(initialData);
        });

        // Tombol toggle-edit
        document.querySelectorAll('.toggle-edit').forEach(btn => {
            btn.addEventListener('click', function (e) {
                e.preventDefault();
                console.log("----icon edit called----");
                const targetId = this.getAttribute('data-target-id');
                const cardBody = this.closest('.card-body');
                const desc = cardBody.querySelector('.desc');
                const collapse = cardBody.querySelector(`#${targetId}`);
                const form = collapse.querySelector('.edit-item-form');
                const bsCollapse = new bootstrap.Collapse(collapse, { toggle: false });

                // Cek apakah collapse sedang terbuka
                if (collapse.classList.contains('show')) {
                    // âœ… 1. Tutup collapse
                    bsCollapse.hide();
                    desc.style.display = ''; // tampilkan kembali deskripsi

                    // âœ… 2. Kembalikan semua input ke nilai awal <why doublle clic?>
                    if (form && form.dataset.initialData) {
                        initialData = JSON.parse(form.dataset.initialData);
                        form.querySelectorAll('input, textarea, select').forEach(input => {
                            if (initialData.hasOwnProperty(input.name)) {
                                input.value = initialData[input.name];
                            }
                        });
                    }


                    // âœ… 3. Hilangkan status aktif toggle
                    this.classList.remove('active');
                    this.setAttribute('aria-expanded', 'false');



                } else {
                    // âœ… 4. Buka collapse
                    bsCollapse.show();
                    desc.style.display = 'none'; // sembunyikan section

                    // âœ… 5. Tambahkan status aktif
                    this.classList.add('active');
                    this.setAttribute('aria-expanded', 'true');

                    // âœ… reset text tombol  jadi Cancel
                    const cancelBtn = form.querySelector('.cancel-collapse');
                    if (cancelBtn) cancelBtn.textContent = 'Cancel';
                }
            });
        });

        // Tombol Cancel di dalam form
        document.querySelectorAll('.cancel-collapse').forEach(btn => {
            btn.addEventListener('click', function (e) {
                console.log("----button cancel called----");
                const targetId = this.getAttribute('data-target-id');
                const targetCollapse = document.getElementById(targetId);
                const bsCollapse = bootstrap.Collapse.getInstance(targetCollapse)
                    || new bootstrap.Collapse(targetCollapse, { toggle: false });
                bsCollapse.hide();

                // âœ… ambil form terkait
                const form = targetCollapse.querySelector('.edit-item-form');
                if (form && form.dataset.initialData) {
                    const initialData = JSON.parse(form.dataset.initialData);
                    form.querySelectorAll('input, textarea, select').forEach(input => {
                        if (initialData.hasOwnProperty(input.name)) {
                            input.value = initialData[input.name];
                        }
                    });
                }

                // âœ… tampilkan kembali deskripsi
                const cardBody = this.closest('.card-body');
                const desc = cardBody.querySelector('.desc');
                if (desc) desc.style.display = '';

                // âœ… toggle-edit kembali ke non-aktif
                const toggleBtn = document.querySelector(`.toggle-edit[data-target-id='${targetId}']`);
                if (toggleBtn) {
                    toggleBtn.classList.remove('active');
                    toggleBtn.setAttribute('aria-expanded', 'false');
                }
            });
        });

        // ðŸ”¹ Tombol accordion utama
        document.querySelectorAll('.accordion-button').forEach(btn => {
            btn.addEventListener('click', function () {
                console.log('Accordion diklik â€” reset semua collapse di dalam card ini.');

                // Ambil card-body terkait tombol accordion ini
                const cardBody = this.closest('.card-body');
                if (!cardBody) return;

                // Tutup semua collapse di dalam accordion yang sama
                cardBody.querySelectorAll('.collapse.show').forEach(collapse => {
                    const bsCollapse = bootstrap.Collapse.getInstance(collapse)
                        || new bootstrap.Collapse(collapse, { toggle: false });
                    bsCollapse.hide();

                    // Tampilkan kembali deskripsi
                    const desc = cardBody.querySelector('.desc');
                    if (desc) desc.style.display = '';

                    // Reset form di dalam collapse
                    const form = collapse.querySelector('.edit-item-form');
                    if (form && form.dataset.initialData) {
                        const initialData = JSON.parse(form.dataset.initialData);
                        form.querySelectorAll('input, textarea, select').forEach(input => {
                            if (initialData.hasOwnProperty(input.name)) {
                                input.value = initialData[input.name];
                            }
                        });
                    }

                    // Hilangkan status aktif tombol edit terkait
                    const targetId = collapse.id;
                    const toggleBtn = cardBody.querySelector(`.toggle-edit[data-target-id='${targetId}']`);
                    if (toggleBtn) {
                        toggleBtn.classList.remove('active');
                        toggleBtn.setAttribute('aria-expanded', 'false');
                    }
                });
            });
        });
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
      const priceInput = document.getElementById("price");

      const hiddenInput = document.getElementById("priceRaw");
      console.log("priceRaw = "+hiddenInput);

      // Format angka jadi currency (US locale)
    function formatCurrency(value) {
      if (!value) return "";
      // Ubah semua karakter non-digit/dot/comma jadi kosong
      const num = parseFloat(value.replace(/[^0-9.,]/g, "").replace(",", "."));
      if (isNaN(num)) return "";
      return new Intl.NumberFormat('en-US', {
        minimumFractionDigits: 0,
        maximumFractionDigits: 2
      }).format(num);
    }

      // Saat load pertama kali
      //priceInput.value = formatCurrency(priceInput.value);

      // Event: setiap kali user ketik
      priceInput.addEventListener("input", function(e) {
        console.log("detected");
        const cleanValue = e.target.value.replace(/[^0-9]/g, "");
        hiddenInput.value = cleanValue; // nilai murni untuk dikirim ke server
        e.target.value = formatCurrency(cleanValue);
      });

      // Pastikan saat form disubmit, nilai yang dikirim adalah angka murni
      priceInput.form?.addEventListener("submit", function() {
        hiddenInput.value = priceInput.value.replace(/\D/g, "");
      });
    });
</script>
<!-- send edit form -->
<script>
    document.addEventListener("DOMContentLoaded", () => {

        document.querySelectorAll(".edit-item-form").forEach(form => {
            form.addEventListener("submit", async (event) => {
                event.preventDefault();

                const itemId = form.dataset.itemId;
                console.log("desc payload"+form.querySelector("textarea[name='description']").value);
                const payload = {
                    name: form.querySelector("input[name='name']").value,
                    description: form.querySelector("textarea[name='description']").value,
                    price: parseFloat(form.querySelector("input[name='priceRaw']").value) || 0
                };

                try {
                console.log("c-path="+contextPath);
                    const res = await fetch(`${contextPath}api/v1/manager/product/item/${itemId}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(payload)
                    });

                    if (!res.ok) {
                        console.error("res NOT OK");
                        throw new Error(`HTTP ${res.status}`);
                    }
                    else {
                        console.log("res OK");
                        const data = await res.json();
                        console.log("âœ… Update success:", data.name);
                        console.log("âœ… Update success:", data.description);
                        console.log("âœ… Update success:", data.price);
                        //alert(`Item ${itemId} berhasil diperbarui!`);
                        showToastText("msgSuccessUpdate", toastShortTimeout, greenSuccess,"#fff");
                        const card = document.querySelector(`[data-item-id="${itemId}"]`);
                        if (card) {
                            const nameElem = card.querySelector(`#itemName${itemId}`);
                            //const formNameElem = card.querySelector(`#formItemName${itemId}`);
                            const descElem = card.querySelector(`#itemDesc${itemId}`);
                            const priceElem = card.querySelector(`#itemPrice${itemId}`);
                            const priceFormattedElem = card.querySelector(`#itemPriceFormatted${itemId}`);
                            const priceNotSetLi = card.querySelector(`#price-notset-${itemId}`);


                            if (nameElem) nameElem.textContent = data.name || "";
                            //if (formNameElem) formNameElem.textContent = data.name || "";
                            if (descElem) descElem.textContent = data.description || "Description kosong";
                            if (priceElem) priceElem.value = data.price ?? 0;

                            const price = data.price ?? 0;

                            // ðŸ”¹ Update tampilan harga
                            if (priceFormattedElem) {
                                if (price > 0) {
                                    priceFormattedElem.textContent = price.toLocaleString('id-ID');
                                    priceFormattedElem.classList.remove('text-danger');
                                    priceFormattedElem.classList.add('text-primary');
                                    priceFormattedElem.style.fontSize = '125%';
                                } else {
                                    priceFormattedElem.textContent = '0';
                                    priceFormattedElem.classList.remove('text-primary');
                                    priceFormattedElem.classList.add('text-danger');
                                    priceFormattedElem.style.fontSize = '90%';
                                }
                            }

                            // ðŸ”¹ Toggle indikator harga belum diatur
                            if (priceNotSetLi) {
                                if (price > 0) {
                                    priceNotSetLi.style.display = 'none'; // sembunyikan kalau sudah ada harga
                                } else {
                                    priceNotSetLi.style.display = 'block'; // tampilkan kalau harga kosong / 0
                                }
                            }

                        }
                        // ðŸ”¹ Update dataset initialData setelah PUT sukses
                        const newInitialData = {
                            name: data.name || "",
                            description: data.description || "",
                            priceRaw: data.price ?? 0,
                            price: data.price ?? 0
                        };
                        form.dataset.initialData = JSON.stringify(newInitialData);
                        console.log("âœ… initialData updated:", form.dataset.initialData);

                        // ðŸ”¹ Toggle indikator deskripsi
                        const descOkLi = card.querySelector(`#desc-ok-${itemId}`);
                        const descNoLi = card.querySelector(`#desc-no-${itemId}`);
                        console.log("data desc="+data.description);
                        if (data.description && data.description.trim() !== "") {
                            if (descOkLi) descOkLi.style.display = 'none';
                            if (descNoLi) descNoLi.style.display = 'none';
                        } else {
                            if (descOkLi) descOkLi.style.display = 'none';
                            if (descNoLi) descNoLi.style.display = 'block';
                        }

                        //Update Harga
                        const priceFormattedElem = card.querySelector(`#itemPriceFormatted${itemId}`);
                        if (priceFormattedElem) {
                            const price = data.price ?? 0;

                            if (price > 0) {
                                // format ribuan manual
                                priceFormattedElem.textContent = price.toLocaleString('id-ID');
                                priceFormattedElem.classList.remove('text-danger');
                                priceFormattedElem.classList.add('text-primary');
                                priceFormattedElem.style.fontSize = '125%';
                            } else {
                                priceFormattedElem.textContent = '0';
                                priceFormattedElem.classList.remove('text-primary');
                                priceFormattedElem.classList.add('text-danger');
                                priceFormattedElem.style.fontSize = '90%';
                            }
                        }

                        // âœ… ubah tombol Cancel jadi Close
                        const cancelBtn = form.querySelector('.cancel-collapse');
                        if (cancelBtn) cancelBtn.textContent = 'Close';
                    }


                } catch (err) {
                    console.error("âŒ Update failed:", err);
                    alert(`Gagal memperbarui item ${itemId}: ${err.message}`);
                }
            });
        });
    });
</script>

<!--HELPER FUNCTION-->
<script>
    // âœ… Fungsi bantu baru: disable/enable semua tombol aksi global
          function setGlobalActionButtonsDisabled(disabled) {
              document.querySelectorAll(".add-sub-btn, .edit-btn, .delete-btn").forEach(btn => {
                btn.disabled = disabled;
                if (disabled) {
                  btn.classList.add("disabled"); // optional, bisa untuk style visual
                } else {
                  btn.classList.remove("disabled");
                }
              });
          }

          // ---------- Utility helpers ----------
          function showToastHtml(html, duration = toastShortTimeout, bg = "#198754") {
            Toastify({
              text: html,
              duration: duration,
              close: true,
              gravity: "bottom",
              position: "center",
              backgroundColor: bg
            }).showToast();
          }

          function showToastText(text, duration = toastShortTimeout, bg = "#198754", warna = "#6c757d") {
            showToastHtml(`<strong style="color:${warna}; text-transform:uppercase;">${text}</strong>`, duration, bg);
          }

          function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
          }

          function createTempLiWithSpinner(name, indent = 0) {
            const tempLi = document.createElement("li");
            tempLi.className = "list-group-item d-flex justify-content-between align-items-center opacity-75";
            tempLi.style.paddingLeft = `${(indent+1) * 25}px`;
            tempLi.innerHTML = `
              <div class="d-flex align-items-center gap-2">
                <div class="spinner-border spinner-border-sm text-secondary" role="status"></div>
                <span class="item-text fw-semibold">${name}</span>
              </div>
            `;
            return tempLi;
          }
</script>
<script>
    const toastMediumTimeout = [[${toastMediumTimeout}]];
    const toastShortTimeout = [[${toastShortTimeout}]];
    const toastLongTimeout = [[${toastLongTimeout}]];
    const redError = "#dc3545";
    const greenSuccess = "#198754";

    const contextPath = document.querySelector('meta[name="contextPath"]').content;

    document.querySelectorAll('.cardImage').forEach(input => {
      const productId = input.getAttribute('data-product-id');
      const hasImage = input.getAttribute('data-has-image') === 'true';

      // Dapatkan elemen <img> thumbnail terdekat
      const cardThumb = input.closest('.p-3').querySelector('.card-thumb');

      const pond = FilePond.create(input, {
        allowMultiple: false,
        allowProcess: true,
        allowRevert: false,
        instantUpload: true,
        acceptedFileTypes: ['image/*'],

        /* ðŸŸ¡ Custom text label */
        labelIdle: hasImage
          ? '<span class="filepond--label-action filepond-btn" style="text-decoration: none;">Change Foto</span>'
          : '<span class="filepond--label-action filepond-btn" style="text-decoration: none;">Upload Foto</span>',

        /* ðŸŸ¢ Konfigurasi server */
        server: {
          process: {
            url: `${contextPath}v1/manager/manage/product/item/upload-image/${productId}`,
            method: 'POST',
            ondata: (formData) => formData,
            onload: (response) => {
              try {
                const data = JSON.parse(response);
                if (data.success && data.url) {
                  console.log("data.success");

                  // update thumbnail image
                  if (cardThumb) {
                    cardThumb.src = (contextPath + data.url).replace(/([^:]\/)\/+/g, "$1");
                    console.log("cardThumb.contextPath=="+contextPath);
                    console.log("data.url=="+data.url);
                  } else {
                    console.log("BENER KESINI");
                    const img = document.createElement('img');
                    const safeUrl = (contextPath + data.url).replace(/([^:]\/)\/+/g, "$1");
                    setTimeout(() => {
                      img.src = safeUrl;
                    }, 200);
                    img.className = 'card-thumb img-fluid mb-2 rounded';
                    img.style.maxHeight = '150px';
                    img.style.objectFit = 'cover';
                    pond.element.parentNode.insertBefore(img, pond.element);
                  }

                  // ðŸ”¹ Update status "image provided"
                  const statusNoImage = document.querySelector(`#status-noimage-${productId}`);
                  console.log("statusNoImage="+statusNoImage);
                  const statusHasImage = document.querySelector(`#status-image-${productId}`);

                  // Sembunyikan li "no image"
                  if (statusNoImage) statusNoImage.style.display = "none";

                  // Tampilkan atau buat li "image provided"
                  if (statusHasImage) {
                    //statusHasImage.style.display = "list-item";
                    statusHasImage.style.display = "none";
                  } else {
                    const ul = document.querySelector(`ul[data-product-id="${productId}"]`);
                    if (ul) {
                      const newLi = document.createElement("li");
                      newLi.id = `status-image-${productId}`;
                      newLi.innerHTML = `
                        <i class="bi bi-check-circle text-success"></i>
                        <span>${msgImageProvided}</span>
                      `;
                      ul.appendChild(newLi);
                    }
                  }

                  // ðŸ”¹ Toggle indikator harga
                    const priceNotSetLi = card.querySelector(`#price-notset-${itemId}`);
                    const priceDisplay = card.querySelector(`#price-display-${itemId}`);
                    const priceFormatted = card.querySelector(`#itemPriceFormatted${itemId}`);

                    if (data.price && data.price > 0) {
                        // âœ… Harga valid â†’ tampilkan <h4> dan sembunyikan <li> not set
                        if (priceNotSetLi) priceNotSetLi.style.display = 'none';
                        if (priceDisplay) priceDisplay.style.display = 'block';
                        if (priceFormatted) {
                            // Format angka pakai ribuan (IDR style)
                            const formatted = new Intl.NumberFormat('id-ID').format(data.price);
                            priceFormatted.textContent = formatted;
                        }
                    } else {
                        // âŒ Harga kosong / 0 â†’ tampilkan <li> not set dan sembunyikan harga
                        if (priceNotSetLi) priceNotSetLi.style.display = 'block';
                        if (priceDisplay) priceDisplay.style.display = 'none';
                    }


                  console.log(`âœ… Thumbnail updated for productId=${productId}`);
                  return data.url;
                }
              } catch (err) {
                console.error("Error parsing server response:", err, response);
              }
            },
            onerror: (response) => {
              console.error("âŒ Upload failed:", response);
            }
          }
        }
      });

      pond.on('processfile', (error, file) => {
        if (error) {
          console.error(`âŒ Upload error for productId=${productId}`, error);
        } else {
          pond.removeFiles();
        }
      });
    });
</script>

    </body>

    </html>