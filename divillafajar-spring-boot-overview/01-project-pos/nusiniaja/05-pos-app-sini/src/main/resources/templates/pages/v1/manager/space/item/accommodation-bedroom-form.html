<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" xmlns:layout="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- inject contextPath -->
    <meta name="contextPath" th:content="@{/}">
    <meta name="pAid" th:content="${session.targetAddress.pubId}">
    <title>Area - item</title>
    <link rel="shortcut icon" th:href="@{/assets/compiled/svg/favicon.svg}" type="image/x-icon}">
    <link rel="shortcut icon"
          href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAiCAYAAADRcLDBAAAEs2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjMzIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMzQiCiAgIGV4aWY6Q29sb3JTcGFjZT0iMSIKICAgdGlmZjpJbWFnZVdpZHRoPSIzMyIKICAgdGlmZjpJbWFnZUxlbmd0aD0iMzQiCiAgIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjIiCiAgIHRpZmY6WFJlc29sdXRpb249Ijk2LjAiCiAgIHRpZmY6WVJlc29sdXRpb249Ijk2LjAiCiAgIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiCiAgIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJwcm9kdWNlZCIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWZmaW5pdHkgRGVzaWduZXIgMS4xMC4xIgogICAgICBzdEV2dDp3aGVuPSIyMDIyLTAzLTMxVDEwOjUwOjIzKzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz5V57uAAAABgmlDQ1BzUkdCIElFQzYxOTY2LTIuMQAAKJF1kc8rRFEUxz9maORHo1hYKC9hISNGTWwsRn4VFmOUX5uZZ36oeTOv954kW2WrKLHxa8FfwFZZK0WkZClrYoOe87ypmWTO7dzzud97z+nec8ETzaiaWd4NWtYyIiNhZWZ2TvE946WZSjqoj6mmPjE1HKWkfdxR5sSbgFOr9Ll/rXoxYapQVik8oOqGJTwqPL5i6Q5vCzeo6dii8KlwpyEXFL519LjLLw6nXP5y2IhGBsFTJ6ykijhexGra0ITl5bRqmWU1fx/nJTWJ7PSUxBbxJkwijBBGYYwhBgnRQ7/MIQIE6ZIVJfK7f/MnyUmuKrPOKgZLpEhj0SnqslRPSEyKnpCRYdXp/9++msneoFu9JgwVT7b91ga+LfjetO3PQ9v+PgLvI1xkC/m5A+h7F32zoLXug38dzi4LWnwHzjeg8UGPGbFfySvuSSbh9QRqZ6H+Gqrm3Z7l9zm+h+iafNUV7O5Bu5z3L/wAdthn7QIme0YAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAJTSURBVFiF7Zi9axRBGIefEw2IdxFBRQsLWUTBaywSK4ubdSGVIY1Y6HZql8ZKCGIqwX/AYLmCgVQKfiDn7jZeEQMWfsSAHAiKqPiB5mIgELWYOW5vzc3O7niHhT/YZvY37/swM/vOzJbIqVq9uQ04CYwCI8AhYAlYAB4Dc7HnrOSJWcoJcBS4ARzQ2F4BZ2LPmTeNuykHwEWgkQGAet9QfiMZjUSt3hwD7psGTWgs9pwH1hC1enMYeA7sKwDxBqjGnvNdZzKZjqmCAKh+U1kmEwi3IEBbIsugnY5avTkEtIAtFhBrQCX2nLVehqyRqFoCAAwBh3WGLAhbgCRIYYinwLolwLqKUwwi9pxV4KUlxKKKUwxC6ZElRCPLYAJxGfhSEOCz6m8HEXvOB2CyIMSk6m8HoXQTmMkJcA2YNTHm3congOvATo3tE3A29pxbpnFzQSiQPcB55IFmFNgFfEQeahaAGZMpsIJIAZWAHcDX2HN+2cT6r39GxmvC9aPNwH5gO1BOPFuBVWAZue0vA9+A12EgjPadnhCuH1WAE8ivYAQ4ohKaagV4gvxi5oG7YSA2vApsCOH60WngKrA3R9IsvQUuhIGY00K4flQG7gHH/mLytB4C42EgfrQb0mV7us8AAMeBS8mGNMR4nwHamtBB7B4QRNdaS0M8GxDEog7iyoAguvJ0QYSBuAOcAt71Kfl7wA8DcTvZ2KtOlJEr+ByyQtqqhTyHTIeB+ONeqi3brh+VgIN0fohUgWGggizZFTplu12yW8iy/YLOGWMpDMTPXnl+Az9vj2HERYqPAAAAAElFTkSuQmCC"
          type="image/png">
    <link rel="stylesheet" th:href="@{/assets/compiled/css/app.css}">
    <link rel="stylesheet" th:href="@{/assets/compiled/css/app-dark.css}">
    <link rel="stylesheet" th:href="@{/assets/compiled/css/iconly.css}">
    <link rel="stylesheet" th:href="@{/mine/js/css/toast.css}">

    <link href="https://unpkg.com/filepond/dist/filepond.css" rel="stylesheet">
    <link href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/assets/vendors/toastify/toastify.css}">
    <link rel="stylesheet" th:href="@{/mine/js/css/additional-index.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/mine/js/css/breadcrumbs.css}">
    <!--link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"-->
    <style>
        .change-image-btn {
            font-size: 0.85rem;
            padding: 0.25rem 0.6rem;
        }

        .filepond--root {
          width: auto !important;
          height: auto !important;
          min-height: auto !important;
          border: none !important;
          background: none !important;
        }

        .filepond--drop-label {
          background: none !important;
          border: none !important;
          padding: 0 !important;
          margin: 0 !important;
          display: inline !important;
          font-size: 0.85rem !important;
          color: #0d6efd !important;
          cursor: pointer !important;
        }

        .filepond--drop-label:hover {
          text-decoration: none;
        }

        .filepond--panel-root,
        .filepond--credits {
          display: none !important;
        }

        .filepond-btn {
          background-color: #007bff;  /* biru */
          color: white;
          padding: 4px 10px;
          border-radius: 6px;
          font-size: 0.75rem;
          border: none;
          cursor: pointer;
          transition: background 0.2s ease-in-out;
        }

        .filepond-btn:hover {
          background-color: #0056b3;  /* hover lebih gelap */
        }

        @media (max-width: 576px) {
            .card-body .d-flex {
                justify-content: center !important;
            }
        }

        /*
        .card-wrapper {
          margin-bottom: 5px !important;
        }
        */

        .card {
          margin-bottom: 0.5rem !important;
        }

        .card-body {
          padding-bottom: 0.75rem !important;
          padding-top: 0.75rem !important;
        }

        /* Warna latar belakang body accordion */
          #collapseOne .accordion-body {
            background-color: #e3f2fd; /* biru muda lembut */
          }

          /* Kalau ada tombol accordion header */
          #headingOne .accordion-button {
            background-color: #bbdefb; /* biru muda */
            color: #0d47a1;            /* teks biru tua */
          }

          /* Saat tombol accordion terbuka (expanded) */
          #headingOne .accordion-button:not(.collapsed) {
            background-color: #90caf9; /* biru sedikit lebih terang */
            color: #0d47a1;
            box-shadow: none;
          }

        .accordion-button .category-label {
          color: [[${@appGlobals.get('colorPrimaryBlue')}]];
          font-weight: 600;
          font-size: 120%;
          margin-left: 4px;
          transition: color 0.2s ease;
        }

        /* Saat tombol TIDAK collapsed (berarti terbuka) */
        .accordion-button:not(.collapsed) .category-label {
          color: [[${@appGlobals.get('colorPrimaryBlue')}]];
        }

        .accordion-icon i {
          transition: transform 0.3s ease;
          color: #0d6efd;
        }

        /* saat aktif (accordion terbuka) */
        .accordion-button:not(.collapsed) .accordion-icon i {
          transform: rotate(180deg);
        }

        .accordion-button {
            pointer-events: none;
        }


    </style>
    <script th:inline="javascript">
        const path = [[${path}]];
        console.log("path => " + path);
    </script>
</head>
<body>
<div class="toast-container position-fixed top-0 end-0 p-3">
    <div id="toastRequired"
         class="toast align-items-center text-bg-danger border-0"
         role="alert" aria-live="assertive" aria-atomic="true">

        <div class="d-flex">
            <div class="toast-body" th:text="#{msg.fillRequiredFields}">
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto"
                    data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>


<div id="app">
    <!-- Sidebar slot -->
    <div layout:fragment="sidebar">
        <div th:replace="~{/pages/v1/manager/product/sidebar.html :: sidebar(${activePage}, ${activeSub}, '${listActiveLocation}')}"></div>
    </div>
    <div id="main">
        <!-- Notification hamburg slot -->
        <div layout:fragment="left-header">
            <div th:replace="~{/pages/v1/fragments/hamburger-header.html :: left-header}"></div>
        </div>
        <!-- Notification header slot
        <div layout:fragment="left-header">
            <div th:replace="~{/pages/v1/manager/fragments/notification-header.html :: right-header}"></div>
        </div-->
        <!-- Index header slot -->
        <div layout:fragment="logout-and-other-hidden-form">
            <div th:replace="~{/pages/v1/fragments/logout-and-other-hidden-form.html :: hidden-form(${clientName}, ${updatePath}, ${deletePath})}"></div>
        </div>

        <!-- Main content slot -->
        <div class="page-heading">
            <ol class="breadcrumb">
                <th:block th:replace="~{/pages/v1/fragments/crumbs/manager-area-root-crumb.html :: manager-product-root-crumb}"></th:block>
                <li sec:authorize="hasAnyRole('SUPERADMIN','ADMIN','MANAGER')" class="breadcrumb-item active">
                    <a th:href="@{/v1/manager/manage/area/item(pid=${targetAddress.pubId},activePage='menu1',activeSub='subMenu1-2')}"
                    th:text="|${#messages.msg('label.unitArea')}|"></a>
                </li>
                <li sec:authorize="hasAnyRole('SUPERADMIN','ADMIN','MANAGER')" class="breadcrumb-item"
                    aria-current="page"><!-- th:text="|${#messages.msg('label.itemList')}|"-->
                    <span th:with="
                    parts=${#strings.arraySplit(trimPath, '/')},
                    lastIndex=${#lists.size(parts) - 1}">

                    <span th:each="p, iter : ${parts}">
                        <span th:if="${iter.last}"
                              th:text="${p.trim()}">
                        </span>
                    </span>
                </span>
                </li>
            </ol>
            <h3>
                <span style="font-size:70%; display:block; line-height:1;"
                      th:text="|${#strings.toUpperCase(#messages.msg('label.setting'))}|">
                </span>
                <span th:with="
                    parts=${#strings.arraySplit(trimPath, '/')},
                    lastIndex=${#lists.size(parts) - 1}">

                    <span th:each="p, iter : ${parts}">
                        <span th:if="${!iter.last}"
                              th:text="|${p.trim()} / |"
                              style="color: gray;font-size:65%"></span>
                        <span th:if="${iter.last}"
                              th:text="${p.trim()}"
                              style="color: #0d6efd; font-weight: 600;font-size:120%"></span>
                    </span>
                </span>

                <!--span th:text="|${#strings.toUpperCase(#messages.msg('label.manager.setting.product.item'))} / ${#strings.toUpperCase(#messages.msg('label.manager.setting.product.barang'))}|"></span-->

            </h3>
        </div>
        <div layout:fragment="content">
            <div class="page-content">
                <!-- list group button & badge start-->
                <div class="d-inline-flex align-items-center gap-2 flex-nowrap">
                    <button type="button" id="add"
                            class="d-flex align-items-center justify-content-center"
                            th:style="|background-color:${@appGlobals.get('colorPrimaryBlue')};
                       color:white;padding-bottom:8px;padding-right:13px;
                       width:32px;
                       height:32px;
                       border:none;
                       border-radius:50%;
                       line-height:0;|">
                        <i class="bi bi-plus" style="font-size:150%;"></i>
                    </button>
                    <!--a th:href="@{/produk}" th:text="#{label.add}"></a-->
                    <span th:text="#{label.add}" id="txtAdd"></span>
                </div>

                <div class="card collapse-icon accordion-icon-rotate" id="collapsableCard">
                    <div class="card-body">
                        <div class="accordion" id="cardAccordion">
                            <div class="accordion" id="accordionExample">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingOne">
                                        <button class="accordion-button" type="button">
                                            <!-- Ikon plus -->

                                            <span th:text="|#{title.bedroomInfo}|"
                                                  style="font-weight: 600;font-size:120%; margin-left:4px" class="category-label"></span>

                                        </button>
                                    </h2>
                                    <div id="collapseOne" class="accordion-collapse collapse show"
                                         aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                                        <div class="accordion-body" id="addSearch">
                                            <form class="form needs-validation" novalidate method="post" th:action="@{/v1/manager/manage/area/item/{areaId}(areaId=${categoryId},activePage=${activePage},activeSub=${activeSub})}">
                                                <div class="form-body">
                                                    <div class="form-group">
                                                        <!--label for="feedback1" class="sr-only" th:text="#{label.unitName}"></label-->
                                                        <input type="hidden" name="path" th:value="${path}">
                                                        <input type="text" id="feedback1" class="form-control" th:placeholder="#{msg.bedroomName}"
                                                               name="name" required>
                                                    </div>
                                                    <!--div class="form-group form-label-group">
                                                        <textarea class="form-control" name="description" id="label-textarea" rows="3"
                                                                  th:placeholder="#{label.description}"></textarea>
                                                        <label for="label-textarea"></label>
                                                    </div-->
                                                    <!-- Section tambahan: tampil hanya jika path mulai dengan 'accomodation' -->
                                                    <div th:if="${path != null and (#strings.toLowerCase(path).startsWith('accomodation'.toLowerCase()) or #strings.toLowerCase(path).startsWith('akomodasi'.toLowerCase()))}">
                                                        <hr>
                                                        <div class="form-group">
                                                        <span th:text="#{label.bedComposition}"
                                                              style="font-weight: 600;font-size:120%; margin-left:0px; padding-bottom:5px" class="category-label text-primary mb-3"></span>
                                                            <!--label class="form-label text-primary">Extra Info for Accomodation</label-->
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group row align-items-center">
                                                                        <div class="col-lg-8 col-9">
                                                                            <label class="col-form-label text-black-50" for="singleBed" th:utext="|#{label.singleBed}|"></label>
                                                                        </div>
                                                                        <div class="col-lg-4 col-3">
                                                                            <input type="text" id="singleBed" class="form-control" name="singleBed"
                                                                                   placeholder="0" step="1" min="0" required>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group row align-items-center">
                                                                        <div class="col-lg-8 col-9">
                                                                            <label class="col-form-label text-black-50" for="doubleBed" th:utext="|#{label.doubleBed}|"></label>
                                                                        </div>
                                                                        <div class="col-lg-4 col-3">
                                                                            <input type="text" id="doubleBed" class="form-control" name="doubleBed"
                                                                                   placeholder="0" step="1" min="0" required>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group row align-items-center">
                                                                        <div class="col-lg-8 col-9">
                                                                            <label class="col-form-label text-black-50" for="queenBed" th:utext="|#{label.queenBed}|"></label>
                                                                        </div>
                                                                        <div class="col-lg-4 col-3">
                                                                            <input type="text" id="queenBed" class="form-control" name="queenBed"
                                                                                   placeholder="0" step="1" min="0" required>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group row align-items-center">
                                                                        <div class="col-lg-8 col-9">
                                                                            <label class="col-form-label text-black-50" for="kingBed" th:utext="|#{label.kingBed}|"></label>
                                                                        </div>
                                                                        <div class="col-lg-4 col-3">
                                                                            <input type="text" id="kingBed" class="form-control" name="kingBed"
                                                                                   placeholder="0" step="1" min="0" required>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group row align-items-center">
                                                                        <div class="col-lg-8 col-9">
                                                                            <label class="col-form-label text-black-50" for="superKingBed" th:utext="|#{label.total} #{label.superKingBed}|"></label>
                                                                        </div>
                                                                        <div class="col-lg-4 col-3">
                                                                            <input type="text" id="superKingBed" class="form-control" name="superKingBed"
                                                                                   placeholder="0" step="1" min="0" required>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group row align-items-center">
                                                                        <div class="col-lg-8 col-9">
                                                                            <label class="col-form-label text-black-50" for="bunkBed" th:utext="|#{label.bunkBed}|"></label>
                                                                        </div>
                                                                        <div class="col-lg-4 col-3">
                                                                            <input type="text" id="bunkBed" class="form-control" name="bunkBed"
                                                                                   placeholder="0" step="1" min="0" required>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group row align-items-center">
                                                                        <div class="col-lg-8 col-9">
                                                                            <label class="col-form-label text-black-50" for="roomArea" th:utext="|#{label.roomArea}|"></label>
                                                                        </div>
                                                                        <div class="col-lg-4 col-3">
                                                                            <input type="text" id="roomArea" class="form-control" name="roomArea"
                                                                                   placeholder="0" step="1" min="0" required>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <hr>
                                                            <span th:text="#{label.bedroomFacilities}"
                                                                  style="font-weight: 600;font-size:120%; margin-left:0px; margin-bottom:0" class="category-label text-primary mb-4"></span>
                                                            <br>
                                                            <div class="row row-cols-2">
                                                                <div class="col mb-2" th:each="bedroom : ${bedroomFacilities}">
                                                                    <div class="form-check" style="margin-left:15px">
                                                                        <input class="form-check-input form-check-primary form-check-glow"
                                                                               type="checkbox"
                                                                               th:id="${'bed_' + bedroom.name()}"
                                                                               th:name="bedroomFacilities"
                                                                               th:value="${bedroom.name()}"
                                                                               th:checked="${selectedGeneralFacilities != null and selectedGeneralFacilities.contains(bedroom)}">

                                                                        <label class="form-check-label text-black-50"
                                                                               th:for="${'bed_' + bedroom.name()}"
                                                                               th:text="${@enumTranslator.translate(bedroom)}">
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- END conditional section -->
                                                <div class="form-actions d-flex justify-content-end">
                                                    <button type="submit" class="btn btn-primary me-1" th:text="#{label.add}"></button>
                                                    <button type="reset" class="btn btn-light-primary" th:text="#{label.cancel}"></button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- list group button & badge ends -->
                <div class="row" id="productList">
                    <!-- ðŸ” Loop semua produk -->

                </div>
            </div>
        </div>
        <!-- Footer slot -->
        <div layout:fragment="footer">
            <div th:replace="~{/pages/v1/fragments/footer.html :: footer}"></div>
        </div>
    </div>
</div>

<!-- ðŸ”¹ Toast Notification -->
<!--div id="toast-success" class="toast align-items-center text-white bg-success border-0 position-fixed bottom-0 end-0 m-4" role="alert">
    <div class="d-flex">
        <div class="toast-body">
            âœ… Gambar berhasil diperbarui!
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
</div-->
<!-- List of Toast Msg -->
<div id="toast-msg-update-failed" th:data-msg="#{label.updateFailed}"></div>
<div id="toast-msg-update-success" th:data-msg="#{label.updateSuccessfully}"></div>


<!-- Toast status slot -->
<div layout:fragment="toast-status">
    <div th:replace="~{/pages/v1/fragments/toast/toast-status-process-result :: toast-messages(${successMessage}, ${errorMessage}, ${session.toastTimeout})}"></div>
</div>
<!-- Toast confirm slot -->
<div layout:fragment="toast-confirm">
    <!--div th:replace="~{/pages/v1/manager/fragments/toast-confirm.html :: toast-confirm('cancel', 'update', 'delete')}"></div-->
    <div th:replace="~{/pages/v1/fragments/toast/toast-confirm.html :: toast-confirm('cancel', 'update', 'delete')}"></div>
</div>
<!--script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script-->
<!--script th:src="@{/assets/static/js/bootstrap/V5.3.8/bootstrap.bundle.min.js}"></script-->

<script th:src="@{/assets/static/js/initTheme.js}"></script>
<script th:src="@{/assets/static/js/components/dark.js}"></script>
<script th:src="@{/assets/extensions/perfect-scrollbar/perfect-scrollbar.min.js}"></script>
<script th:src="@{/assets/vendors/toastify/toastify.js}"></script>
<script th:src="@{/assets/compiled/js/app.js}"></script>
<!--script th:src="@{/assets/static/js/pages/dashboard.js}"></script-->
<script th:src="@{/mine/js/toast-handler.js}"></script>
<!-- âœ…filepond Tambahkan di bawah, sebelum </body> -->
<script src="https://unpkg.com/filepond/dist/filepond.min.js"></script>
<script src="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.min.js"></script>
<link href="https://unpkg.com/filepond/dist/filepond.min.css" rel="stylesheet" />
<link href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.min.css" rel="stylesheet" />

<div layout:fragment="modal-confirm-delete">
    <!--div th:replace="~{/pages/v1/manager/fragments/toast-confirm.html :: toast-confirm('cancel', 'update', 'delete')}"></div-->
    <div th:replace="~{/pages/v1/fragments/modal/modal-confirm-delete.html :: modal-confirm-delete(${#strings.toUpperCase(#messages.msg('modal.confirm.delete.title'))},
    #{modal.confirm.delete.body},'itemNameReplaceByJs',#{label.cancel}, #{label.delete})}"></div>
</div>
<!--script th:src="@{/mine/js/modal/modal-confirm-edit-delete.js}"></script-->

<!-- ðŸ”¹ Script -->
<script src="https://unpkg.com/filepond@^4/dist/filepond.js"></script>



<script th:inline="javascript">
    const msgImageProvided = /*[[#{msg.imageProvided}]]*/ 'Image provided';
  const msgNoImageProvided = /*[[#{msg.noImageProvided}]]*/ 'No image provided';
  const toastMediumTimeout = [[${toastMediumTimeout}]];
    const toastShortTimeout = [[${toastShortTimeout}]];
    const toastLongTimeout = [[${toastLongTimeout}]];
    const colorDanger = [[${globals.get('colorDanger')}]];
    const colorWhite = [[${globals.get('colorWhite')}]];
    //const toastLongTimeout = [[${globals.get('toastLongTimeout')}]];
    document.addEventListener("DOMContentLoaded", function () {
        const addBtn = document.getElementById("add");
        const txtAdd = document.getElementById("txtAdd");
        const txtSearch = document.getElementById("txtSearch");
        const searchCard = document.getElementById("searchCard");
        const collapsableCard = document.getElementById("collapsableCard");

        const searchInput = document.getElementById("searchKeyword");
        const productList = document.getElementById("productList");
        const cards = productList ? productList.querySelectorAll(".col-xl-4, .col-md-6, .col-sm-12") : [];

        const colorPrimaryBlue = /*[[${@appGlobals.get('colorPrimaryBlue')}]]*/ '#007bff';
        const colorSecondaryGrey = /*[[${@appGlobals.get('colorSecondaryGrey')}]]*/ '#6c757d';

        // Kondisi awal
        searchCard.style.display = "none";
        collapsableCard.style.display = "block";
        addBtn.style.backgroundColor = colorPrimaryBlue;


        // Tombol Add
        addBtn.addEventListener("click", function () {
            searchCard.style.display = "none";
            collapsableCard.style.display = "block";
            addBtn.style.backgroundColor = colorPrimaryBlue;

            // ðŸ”¹ Reset filter search
            if (searchInput) {
                searchInput.value = ""; // kosongkan input
                cards.forEach(card => card.style.display = ""); // tampilkan semua kartu
            }

            // ðŸ”¹ Force buka collapsible (accordion)
            const collapseOne = document.getElementById("collapseOne");
            const accordionBtn = document.querySelector("[data-bs-target='#collapseOne']");

            if (collapseOne && accordionBtn) {
                const bsCollapse = bootstrap.Collapse.getOrCreateInstance(collapseOne);

                // Tutup dulu semua biar fresh
                bsCollapse.hide();

                // Buka ulang (force expand)
                bsCollapse.show();

                // Pastikan tombol header tidak pakai class 'collapsed'
                accordionBtn.classList.remove("collapsed");
                accordionBtn.setAttribute("aria-expanded", "true");
            }
        });

        // ðŸ”¹ Klik teks = klik tombol
        txtAdd.addEventListener("click", function () {
            addBtn.click();
        });



        // ðŸ”¹ (Opsional) Tambahkan efek hover pada teks agar terasa interaktif
        [txtAdd, txtSearch].forEach(el => {
            el.style.cursor = "pointer";
            el.addEventListener("mouseenter", () => el.style.textDecoration = "underline");
            el.addEventListener("mouseleave", () => el.style.textDecoration = "none");
        });
    });
</script>
<!-- === SCRIPT UNTUK FORM PENCARIAN DINAMIS === -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("searchKeyword");
        const productList = document.getElementById("productList");
        const cards = productList.querySelectorAll(".col-xl-4, .col-md-6, .col-sm-12");

        searchInput.addEventListener("input", function () {
            const keyword = this.value.trim().toLowerCase();

            cards.forEach(card => {
                const titleElement = card.querySelector(".card-title");
                const descElement = card.querySelector(".card-text");
                const name = titleElement ? titleElement.textContent.toLowerCase() : "";
                const desc = descElement ? descElement.textContent.toLowerCase() : "";

                // kalau deskripsi "Description Unavailable", abaikan
                const isDescUnavailable = desc.includes("description unavailable");

                // kalau keyword kosong â†’ tampilkan semua
                if (keyword === "") {
                    card.style.display = "";
                }
                // kalau keyword cocok dengan nama atau deskripsi â†’ tampilkan
                else if (!isDescUnavailable && (name.includes(keyword) || desc.includes(keyword))) {
                    card.style.display = "";
                }
                // kalau tidak cocok â†’ sembunyikan
                else {
                    card.style.display = "none";
                }
            });
        });
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const contextPath = document.querySelector("meta[name='contextPath']").content;
      // ðŸ”¹ Simpan nilai awal form saat pertama kali dimuat
      document.querySelectorAll('.edit-item-form').forEach(form => {
        const initialData = {};
        form.querySelectorAll('input, textarea, select').forEach(input => {
          initialData[input.name] = input.value;
        });
        form.dataset.initialData = JSON.stringify(initialData);
      });


      // ðŸ”¹ Tombol toggle-edit DAN toggle-delete
      document.querySelectorAll('.toggle-edit, .toggle-delete').forEach(btn => {
        btn.addEventListener('click', function (e) {
          e.preventDefault();
          e.stopPropagation(); // cegah trigger accordion

          const isEdit = this.classList.contains('toggle-edit');
          const isDelete = this.classList.contains('toggle-delete');

          // pastikan accordion terbuka dulu sebelum toggle collapse
          const accordionItem = this.closest('.accordion-item');
          if (accordionItem) {
            const accordionBody = accordionItem.querySelector('.accordion-collapse');
            if (accordionBody && !accordionBody.classList.contains('show')) {
              const bsAccordion = new bootstrap.Collapse(accordionBody, { toggle: false });
              bsAccordion.show();
            }
          }

          const targetId = this.getAttribute('data-target-id');
          const collapse = document.getElementById(targetId);
          if (!collapse) {
            console.warn(`Collapse target #${targetId} tidak ditemukan.`);
            return;
          }

          const form = collapse.querySelector('.edit-item-form');
          const card = this.closest('[data-item-id]');
          const desc = card.querySelector('.desc');
          const bsCollapse = new bootstrap.Collapse(collapse, { toggle: false });

          // kalau collapse sedang terbuka â†’ tutup
          if (collapse.classList.contains('show')) {
            bsCollapse.hide();
            if (desc) desc.style.display = '';

            // kembalikan input ke nilai awal
            if (form && form.dataset.initialData) {
              const initialData = JSON.parse(form.dataset.initialData);
              form.querySelectorAll('input, textarea, select').forEach(input => {
                if (initialData.hasOwnProperty(input.name)) {
                  input.value = initialData[input.name];
                }
              });
            }

            this.classList.remove('active');
            this.setAttribute('aria-expanded', 'false');

          } else {
            // kalau collapse belum terbuka â†’ buka
            bsCollapse.show();
            if (desc) desc.style.display = 'none';

            this.classList.add('active');
            this.setAttribute('aria-expanded', 'true');

            // ubah tombol cancel jadi "Cancel"
            const cancelBtn = form.querySelector('.cancel-collapse');
            if (cancelBtn) cancelBtn.textContent = 'Cancel';
          }
        });
      });


      // ðŸ”¹ Tombol Cancel (berlaku untuk form edit & delete)
      document.querySelectorAll('.cancel-collapse').forEach(btn => {
        btn.addEventListener('click', function (e) {
          e.preventDefault();

          const targetId = this.getAttribute('data-target-id');
          const targetCollapse = document.getElementById(targetId);
          if (!targetCollapse) return;

          const bsCollapse = bootstrap.Collapse.getInstance(targetCollapse)
            || new bootstrap.Collapse(targetCollapse, { toggle: false });
          bsCollapse.hide();

          // kembalikan nilai awal form jika ada
          const form = targetCollapse.querySelector('.edit-item-form');
          if (form && form.dataset.initialData) {
            const initialData = JSON.parse(form.dataset.initialData);
            form.querySelectorAll('input, textarea, select').forEach(input => {
              if (initialData.hasOwnProperty(input.name)) {
                input.value = initialData[input.name];
              }
            });
          }

          // tampilkan kembali deskripsi
          const cardBody = this.closest('.card-body');
          const desc = cardBody.querySelector('.desc');
          if (desc) desc.style.display = '';

          // reset tombol toggle (baik edit maupun delete)
          const toggleBtn = document.querySelector(`.toggle-edit[data-target-id='${targetId}'], .toggle-delete[data-target-id='${targetId}']`);
          if (toggleBtn) {
            toggleBtn.classList.remove('active');
            toggleBtn.setAttribute('aria-expanded', 'false');
          }
        });
      });


      // ðŸ”¹ Tombol accordion utama â†’ reset semua collapse di dalamnya
      document.querySelectorAll('.accordion-button').forEach(btn => {
        btn.addEventListener('click', function () {

          const cardBody = this.closest('.card-body');
          if (!cardBody) return;

          cardBody.querySelectorAll('.collapse.show').forEach(collapse => {
            const bsCollapse = bootstrap.Collapse.getInstance(collapse)
              || new bootstrap.Collapse(collapse, { toggle: false });
            bsCollapse.hide();

            const desc = cardBody.querySelector('.desc');
            if (desc) desc.style.display = '';

            const form = collapse.querySelector('.edit-item-form');
            if (form && form.dataset.initialData) {
              const initialData = JSON.parse(form.dataset.initialData);
              form.querySelectorAll('input, textarea, select').forEach(input => {
                if (initialData.hasOwnProperty(input.name)) {
                  input.value = initialData[input.name];
                }
              });
            }

            // reset tombol aktif (edit & delete)
            const targetId = collapse.id;
            cardBody.querySelectorAll(`.toggle-edit[data-target-id='${targetId}'], .toggle-delete[data-target-id='${targetId}']`).forEach(btn => {
              btn.classList.remove('active');
              btn.setAttribute('aria-expanded', 'false');
            });
          });
        });
      });

      // ðŸ”¹ Tangani submit form delete
        document.querySelectorAll('.collapse form').forEach(form => {
          // pastikan ini form delete (bukan edit)
          const collapseParent = form.closest('.collapse');
          if (collapseParent && collapseParent.id.startsWith('collapseDelete')) {
            form.addEventListener('submit', async function (e) {
              e.preventDefault();
              e.stopPropagation();

              const itemId = this.getAttribute('data-item-id');
              if (!itemId) {
                console.warn("Item ID tidak ditemukan di form delete.");
                return;
              }

              // konfirmasi dulu
              //if (!confirm('Yakin ingin menghapus item ini?')) return;
            // Ambil card lebih awal sebelum async
            const collapse = this.closest('.collapse');
            const card = collapse?.closest('[data-item-id]') || collapse?.closest('.col-xl-4');

              try {
                const response = await fetch(`${contextPath}api/v1/manager/product/item/${itemId}`, {
                  method: 'DELETE',
                  headers: {
                    'Content-Type': 'application/json'
                  }
                });

                if (response.ok) {
                  // ðŸ”¹ tampilkan notifikasi/toast (kalau sudah punya sistem toast)
                  // showToast('Item berhasil dihapus', 'success');

                  // ðŸ”¹ hapus card-nya dari DOM

                  const card = this.closest('.col-xl-4[data-item-id]') || this.closest('[data-item-id]');
                  //const card = this.closest('[data-item-id]') || this.closest('.col-xl-4');
                  //const card = this.closest('[data-item-id]');
                  if (card) {
                      card.style.transition = 'opacity 0.3s ease';
                      card.style.opacity = '0';
                      setTimeout(() => card.remove(), 300);
                    } else {
                      console.warn('Card element tidak ditemukan untuk item:', itemId);
                    }

                } else {
                  console.error('Gagal menghapus item', response.status);
                  showToastText(response.status, toastLongTimeout, colorDanger, colorWhite);
                }
              } catch (err) {
                console.error('Error saat menghapus item:', err);
                // showToast('Terjadi kesalahan saat menghapus item', 'danger');
              }
            });
          }
        });


    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
      document.querySelectorAll(".price-input").forEach(priceInput => {
        const form = priceInput.form;
        const hiddenInput = form?.querySelector(".price-raw");
        if (!hiddenInput) return;

        // Format angka Indonesia
        function formatCurrency(value) {
          if (!value) return "";
          const cleanValue = value.replace(/[^0-9.,]/g, "");
          const num = parseFloat(cleanValue.replace(/\./g, "").replace(",", "."));
          if (isNaN(num)) return "";
          return new Intl.NumberFormat("id-ID", {
            minimumFractionDigits: 0,
            maximumFractionDigits: 2
          }).format(num);
        }

        // Saat user mengetik
        priceInput.addEventListener("input", function(e) {
          const clean = e.target.value.replace(/[^0-9]/g, "");
          hiddenInput.value = clean;
          // Format hanya kalau input tidak kosong
          if (clean) {
            e.target.value = formatCurrency(clean);
          }
        });

        // Saat form submit
        if (form) {
          form.addEventListener("submit", function() {
            hiddenInput.value = priceInput.value.replace(/\D/g, "");
          });
        }
      });
    });
</script>
<!-- send edit form -->
<script>
    document.addEventListener("DOMContentLoaded", () => {

        document.querySelectorAll(".edit-item-form").forEach(form => {
            form.addEventListener("submit", async (event) => {
                event.preventDefault();

                const itemId = form.dataset.itemId;
                const payload = {
                    name: form.querySelector("input[name='name']").value,
                    description: form.querySelector("textarea[name='description']").value,
                    price: parseFloat(form.querySelector("input[name='priceRaw']").value) || 0
                };

                try {
                    const res = await fetch(`${contextPath}api/v1/manager/product/item/${itemId}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(payload)
                    });

                    if (!res.ok) {
                        throw new Error(`HTTP ${res.status}`);
                    }
                    else {
                        const data = await res.json();
                        //alert(`Item ${itemId} berhasil diperbarui!`);
                        showToastText("msgSuccessUpdate", toastShortTimeout, greenSuccess,"#fff");
                        const card = document.querySelector(`[data-item-id="${itemId}"]`);
                        if (card) {
                            const nameElem = card.querySelector(`#itemName${itemId}`);
                            //const formNameElem = card.querySelector(`#formItemName${itemId}`);
                            const descElem = card.querySelector(`#itemDesc${itemId}`);
                            const priceElem = card.querySelector(`#itemPrice${itemId}`);
                            const priceFormattedElem = card.querySelector(`#itemPriceFormatted${itemId}`);
                            const priceNotSetLi = card.querySelector(`#price-notset-${itemId}`);


                            if (nameElem) nameElem.textContent = data.name || "";
                            //if (formNameElem) formNameElem.textContent = data.name || "";
                            if (descElem) descElem.textContent = data.description || "Description kosong";
                            if (priceElem) priceElem.value = data.price ?? 0;

                            const price = data.price ?? 0;

                            // ðŸ”¹ Update tampilan harga
                            if (priceFormattedElem) {
                                if (price > 0) {
                                    priceFormattedElem.textContent = price.toLocaleString('id-ID');
                                    priceFormattedElem.classList.remove('text-danger');
                                    priceFormattedElem.classList.add('text-primary');
                                    priceFormattedElem.style.fontSize = '125%';
                                } else {
                                    priceFormattedElem.textContent = '0';
                                    priceFormattedElem.classList.remove('text-primary');
                                    priceFormattedElem.classList.add('text-danger');
                                    priceFormattedElem.style.fontSize = '90%';
                                }
                            }

                            // ðŸ”¹ Toggle indikator harga belum diatur
                            if (priceNotSetLi) {
                                if (price > 0) {
                                    priceNotSetLi.style.display = 'none'; // sembunyikan kalau sudah ada harga
                                } else {
                                    priceNotSetLi.style.display = 'block'; // tampilkan kalau harga kosong / 0
                                }
                            }

                        }
                        // ðŸ”¹ Update dataset initialData setelah PUT sukses
                        const newInitialData = {
                            name: data.name || "",
                            description: data.description || "",
                            priceRaw: data.price ?? 0,
                            price: data.price ?? 0
                        };
                        form.dataset.initialData = JSON.stringify(newInitialData);

                        // ðŸ”¹ Toggle indikator deskripsi
                        const descOkLi = card.querySelector(`#desc-ok-${itemId}`);
                        const descNoLi = card.querySelector(`#desc-no-${itemId}`);
                        if (data.description && data.description.trim() !== "") {
                            if (descOkLi) descOkLi.style.display = 'none';
                            if (descNoLi) descNoLi.style.display = 'none';
                        } else {
                            if (descOkLi) descOkLi.style.display = 'none';
                            if (descNoLi) descNoLi.style.display = 'block';
                        }

                        //Update Harga
                        const priceFormattedElem = card.querySelector(`#itemPriceFormatted${itemId}`);
                        if (priceFormattedElem) {
                            const price = data.price ?? 0;

                            if (price > 0) {
                                // format ribuan manual
                                priceFormattedElem.textContent = price.toLocaleString('id-ID');
                                priceFormattedElem.classList.remove('text-danger');
                                priceFormattedElem.classList.add('text-primary');
                                priceFormattedElem.style.fontSize = '125%';
                            } else {
                                priceFormattedElem.textContent = '0';
                                priceFormattedElem.classList.remove('text-primary');
                                priceFormattedElem.classList.add('text-danger');
                                priceFormattedElem.style.fontSize = '90%';
                            }
                        }

                        // âœ… ubah tombol Cancel jadi Close
                        const cancelBtn = form.querySelector('.cancel-collapse');
                        if (cancelBtn) cancelBtn.textContent = 'Close';
                    }


                } catch (err) {
                    alert(`Gagal memperbarui item ${itemId}: ${err.message}`);
                }
            });
        });
    });
</script>

<!--HELPER FUNCTION-->
<script>
    // âœ… Fungsi bantu baru: disable/enable semua tombol aksi global
          function setGlobalActionButtonsDisabled(disabled) {
              document.querySelectorAll(".add-sub-btn, .edit-btn, .delete-btn").forEach(btn => {
                btn.disabled = disabled;
                if (disabled) {
                  btn.classList.add("disabled"); // optional, bisa untuk style visual
                } else {
                  btn.classList.remove("disabled");
                }
              });
          }

          // ---------- Utility helpers ----------
          function showToastHtml(html, duration = toastShortTimeout, bg = "#198754") {
            Toastify({
              text: html,
              duration: duration,
              close: true,
              gravity: "bottom",
              position: "center",
              backgroundColor: bg
            }).showToast();
          }

          function showToastText(text, duration = toastShortTimeout, bg = "#198754", warna = "#6c757d") {
            showToastHtml(`<strong style="color:${warna}; text-transform:uppercase;">${text}</strong>`, duration, bg);
          }

          function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
          }

          function createTempLiWithSpinner(name, indent = 0) {
            const tempLi = document.createElement("li");
            tempLi.className = "list-group-item d-flex justify-content-between align-items-center opacity-75";
            tempLi.style.paddingLeft = `${(indent+1) * 25}px`;
            tempLi.innerHTML = `
              <div class="d-flex align-items-center gap-2">
                <div class="spinner-border spinner-border-sm text-secondary" role="status"></div>
                <span class="item-text fw-semibold">${name}</span>
              </div>
            `;
            return tempLi;
          }
</script>
<script>

    const redError = "#dc3545";
    const greenSuccess = "#198754";

    const contextPath = document.querySelector('meta[name="contextPath"]').content;

    document.querySelectorAll('.cardImage').forEach(input => {
      const productId = input.getAttribute('data-product-id');
      const hasImage = input.getAttribute('data-has-image') === 'true';

      // Dapatkan elemen <img> thumbnail terdekat
      const container = input.closest('.p-3');
      let cardThumb = container?.querySelector('.card-thumb');

      const pond = FilePond.create(input, {
        allowMultiple: false,
        allowProcess: true,
        allowRevert: false,
        instantUpload: true,
        acceptedFileTypes: ['image/*'],

        /* ðŸŸ¡ Custom text label */
        labelIdle: hasImage
          ? '<span class="filepond--label-action filepond-btn" style="text-decoration: none;">Change Foto</span>'
          : '<span class="filepond--label-action filepond-btn" style="text-decoration: none;">Upload Foto</span>',

        /* ðŸŸ¢ Konfigurasi server */
        server: {
          process: {
            url: `${contextPath}v1/manager/manage/product/item/upload-image/${productId}`,
            method: 'POST',
            ondata: (formData) => formData,
            onload: (response) => {
              try {
                const data = JSON.parse(response);

                if (data.success && data.url) {
                  // âœ… Hapus dulu thumbnail lama (kalau ada)
                  if (cardThumb && cardThumb.parentNode) {
                    cardThumb.remove();
                  }

                  // âœ… Buat thumbnail baru
                  const img = document.createElement('img');
                  let safeUrl = (contextPath + data.url).replace(/([^:]\/)\/+/g, "$1");
                  safeUrl += (safeUrl.includes('?') ? '&' : '?') + 't=' + new Date().getTime();
                  img.src = safeUrl;
                  img.className = 'card-thumb img-fluid mb-2 rounded';
                  img.style.maxHeight = '150px';
                  img.style.objectFit = 'cover';

                  // Sisipkan di atas input
                  pond.element.parentNode.insertBefore(img, pond.element);
                  cardThumb = img; // simpan referensi thumbnail baru

                  // âœ… Update thumbnail utama di area .desc
                  const descImg = document.querySelector(`#itemDesc${productId}`)
                    ?.closest('section.desc')
                    ?.querySelector('img');
                  if (descImg) {
                    let newSrc = (contextPath + data.url).replace(/([^:]\/)\/+/g, "$1");
                    newSrc += (newSrc.includes('?') ? '&' : '?') + 't=' + new Date().getTime();
                    descImg.src = newSrc;
                    descImg.style.display = "block";
                  }

                  // ðŸ”¹ Update status "image provided"
                  const statusNoImage = document.querySelector(`#status-noimage-${productId}`);
                  const statusHasImage = document.querySelector(`#status-image-${productId}`);
                  if (statusNoImage) statusNoImage.style.display = "none";
                  if (statusHasImage) {
                    statusHasImage.style.display = "none";
                  } else {
                    const ul = document.querySelector(`ul[data-product-id="${productId}"]`);
                    if (ul) {
                      const newLi = document.createElement("li");
                      newLi.id = `status-image-${productId}`;
                      newLi.innerHTML = `
                        <i class="bi bi-check-circle text-success"></i>
                        <span>${msgImageProvided}</span>
                      `;
                      ul.appendChild(newLi);
                    }
                  }
                  return data.url;
                }
              } catch (err) {
                console.error("Error parsing server response:", err, response);
              }
            },
            onerror: (response) => {
              console.error("âŒ Upload failed:", response);
            }
          }
        }
      });

      pond.on('processfile', (error, file) => {
        if (error) {
          console.error(`âŒ Upload error for productId=${productId}`, error);
        } else {
          pond.removeFiles();
        }
      });
    });
</script>
<script th:src="@{/mine/js/toast-status-handler.js}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const toastEl = document.getElementById('toastRequired');
        if (toastEl) {
            toastEl.classList.remove('show'); // pastikan tidak tampil
            toastEl.classList.remove('fade'); // optional, kadang bootstrap menambah fade
            toastEl.classList.add('hide');    // jadikan hidden
        }
    });
    (() => {
        'use strict';

        const forms = document.querySelectorAll('.needs-validation');

        Array.from(forms).forEach(form => {
            form.addEventListener('submit', event => {

                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();

                    // Toast hanya muncul kalau form INVALID
                    const toastEl = document.getElementById('toastRequired');
                    const toast = new bootstrap.Toast(toastEl);
                    toast.show();
                }

                form.classList.add('was-validated');
            }, false);
        });
    })();
</script>


    </body>
</html>